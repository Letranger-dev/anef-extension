<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ANEF Stats â€” Delais</title>
  <link rel="stylesheet" href="shared/common.css">
  <script src="https://cdn.tailwindcss.com"></script>
  <script>
    tailwind.config = {
      theme: {
        extend: {
          colors: {
            bg: '#0f172a',
            'bg-card': '#1e293b',
            'bg-hover': '#334155',
            border: '#334155',
            'text-main': '#e2e8f0',
            'text-muted': '#94a3b8',
            'text-dim': '#64748b',
            primary: '#3b82f6',
            'primary-light': '#60a5fa',
            success: '#10b981',
            warning: '#f59e0b',
            violet: '#8b5cf6',
            danger: '#ef4444',
          },
          maxWidth: { container: '1200px' },
          borderRadius: { card: '12px' },
        }
      }
    }
  </script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4/dist/chart.umd.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-datalabels@2/dist/chartjs-plugin-datalabels.min.js"></script>
</head>
<body class="bg-bg font-sans text-text-main leading-relaxed min-h-screen">

  <!-- Header -->
  <header class="bg-bg-card border-b-[3px]" style="border-image:linear-gradient(to right,#002395,#fff,#ED2939) 1">
    <div class="max-w-container mx-auto px-4 py-5 md:py-8 text-center">
      <h1 class="text-xl md:text-2xl font-bold mb-1">ANEF Status Tracker</h1>
      <p class="text-text-muted text-base">Statistiques communautaires</p>
      <span class="inline-block bg-primary text-white text-xs px-3 py-1 rounded-full mt-2">Donnees anonymes</span>
    </div>
  </header>

  <!-- Desktop Nav -->
  <nav class="hidden md:block sticky top-0 z-50 bg-bg-card/95 backdrop-blur-md border-b border-border">
    <div class="max-w-container mx-auto px-6 flex overflow-x-auto">
      <a href="index.html" class="nav-link py-3 px-5 text-[0.9rem] font-semibold text-text-dim whitespace-nowrap border-b-2 border-transparent hover:text-text-muted transition-colors">Accueil</a>
      <a href="dossiers.html" class="nav-link py-3 px-5 text-[0.9rem] font-semibold text-text-dim whitespace-nowrap border-b-2 border-transparent hover:text-text-muted transition-colors">Dossiers</a>
      <a href="delais.html" class="nav-link py-3 px-5 text-[0.9rem] font-semibold text-text-dim whitespace-nowrap border-b-2 border-transparent hover:text-text-muted transition-colors">Delais</a>
      <a href="prefectures.html" class="nav-link py-3 px-5 text-[0.9rem] font-semibold text-text-dim whitespace-nowrap border-b-2 border-transparent hover:text-text-muted transition-colors">Prefectures</a>
      <a href="tendances.html" class="nav-link py-3 px-5 text-[0.9rem] font-semibold text-text-dim whitespace-nowrap border-b-2 border-transparent hover:text-text-muted transition-colors">Tendances</a>
      <a href="parcours.html" class="nav-link py-3 px-5 text-[0.9rem] font-semibold text-text-dim whitespace-nowrap border-b-2 border-transparent hover:text-text-muted transition-colors">Parcours</a>
    </div>
  </nav>

  <!-- Mobile Nav -->
  <nav class="md:hidden fixed bottom-0 inset-x-0 z-50 bg-bg-card/95 backdrop-blur-md border-t border-border" style="padding-bottom:env(safe-area-inset-bottom,0)">
    <div class="flex justify-around items-stretch h-14">
      <a href="index.html" class="nav-link flex flex-col items-center justify-center flex-1 text-text-dim text-[0.7rem] font-medium">
        <span class="text-xl leading-none mb-0.5">&#x1F3E0;</span>Accueil
      </a>
      <a href="dossiers.html" class="nav-link flex flex-col items-center justify-center flex-1 text-text-dim text-[0.7rem] font-medium">
        <span class="text-xl leading-none mb-0.5">&#x1F4C1;</span>Dossiers
      </a>
      <a href="delais.html" class="nav-link flex flex-col items-center justify-center flex-1 text-text-dim text-[0.7rem] font-medium">
        <span class="text-xl leading-none mb-0.5">&#x23F1;</span>Delais
      </a>
      <a href="prefectures.html" class="nav-link flex flex-col items-center justify-center flex-1 text-text-dim text-[0.7rem] font-medium">
        <span class="text-xl leading-none mb-0.5">&#x1F4CD;</span>Prefectures
      </a>
      <a href="tendances.html" class="nav-link flex flex-col items-center justify-center flex-1 text-text-dim text-[0.7rem] font-medium">
        <span class="text-xl leading-none mb-0.5">&#x1F4CA;</span>Tendances
      </a>
      <a href="parcours.html" class="nav-link flex flex-col items-center justify-center flex-1 text-text-dim text-[0.7rem] font-medium">
        <span class="text-xl leading-none mb-0.5">&#x1F5FA;</span>Parcours
      </a>
    </div>
  </nav>

  <!-- Evolution banner -->
  <div class="max-w-container mx-auto px-4 md:px-6 mt-4">
    <div class="bg-primary/10 border border-primary/30 rounded-card px-4 py-3 text-center text-sm text-text-muted">
      Ce site est en constante evolution et s'ameliore chaque jour. N'hesitez pas a revenir regulierement pour decouvrir les nouveautes !
    </div>
  </div>

  <!-- Loading -->
  <div id="loading" class="text-center py-12 text-text-muted">
    <div class="inline-block w-9 h-9 border-[3px] border-border border-t-primary rounded-full animate-spin mb-4"></div>
    <p class="text-base">Chargement des delais...</p>
  </div>

  <!-- Main Content -->
  <div id="main-content" class="max-w-container mx-auto px-4 md:px-6 py-4 md:py-6 pb-20 md:pb-6" style="display:none">

    <!-- Filters -->
    <div class="filter-bar">
      <div class="filter-group">
        <span class="filter-label">Prefecture</span>
        <div id="filter-prefecture-container"></div>
      </div>
      <div class="filter-group">
        <span class="filter-label">Issue</span>
        <div id="filter-outcome-container"></div>
      </div>
      <span class="filter-count" id="filter-count"></span>
    </div>

    <!-- Estimator -->
    <div class="section" id="estimator-section">
      <h2>Estimateur de delai</h2>
      <p class="section-subtitle">Estimez le temps restant jusqu'a la naturalisation</p>
      <div class="estimator">
        <div class="estimator-form">
          <div class="estimator-field">
            <label>Votre statut actuel</label>
            <div id="estimator-status-container"></div>
          </div>
          <div class="estimator-field">
            <label>Prefecture (optionnel)</label>
            <select id="estimator-prefecture">
              <option value="">Toutes</option>
            </select>
          </div>
        </div>
        <div class="estimator-result" id="estimator-result">
          <div class="estimate-card">
            <div class="estimate-label">Optimiste (P25)</div>
            <div class="estimate-value" style="color:var(--green)" id="est-p25">&mdash;</div>
            <div class="estimate-sub">25% font plus vite</div>
          </div>
          <div class="estimate-card">
            <div class="estimate-label">Mediane (P50)</div>
            <div class="estimate-value" style="color:var(--primary-light)" id="est-p50">&mdash;</div>
            <div class="estimate-sub">estimation typique</div>
          </div>
          <div class="estimate-card">
            <div class="estimate-label">Pessimiste (P75)</div>
            <div class="estimate-value" style="color:var(--orange)" id="est-p75">&mdash;</div>
            <div class="estimate-sub">75% font plus vite</div>
          </div>
        </div>
        <div class="confidence-indicator" id="est-confidence" style="margin-top:0.75rem"></div>
      </div>
    </div>

    <!-- Duration bar chart -->
    <div class="section">
      <h2>Duree depuis le depot par etape</h2>
      <div class="chart-container" style="min-height:380px">
        <canvas id="duration-bar-chart"></canvas>
        <p class="no-data" id="duration-bar-no-data" style="display:none">Pas de donnees</p>
      </div>
    </div>

    <!-- Percentile table -->
    <div class="section">
      <h2>Tableau des percentiles par etape</h2>
      <div class="table-container">
        <table>
          <thead>
            <tr><th>Etape</th><th>P10</th><th>P25</th><th>P50</th><th>P75</th><th>P90</th><th>Echantillon</th></tr>
          </thead>
          <tbody id="percentile-tbody"></tbody>
        </table>
      </div>
    </div>

    <!-- Cumulative curve -->
    <div class="section">
      <h2>Courbe cumulative des durees</h2>
      <p class="section-subtitle">Jours cumules du depot a chaque etape (P25, P50, P75)</p>
      <div class="chart-container" style="min-height:380px">
        <canvas id="cumulative-chart"></canvas>
        <p class="no-data" id="cumulative-no-data" style="display:none">Pas de donnees</p>
      </div>
    </div>

    <!-- Duration table -->
    <div class="section">
      <h2>Durees detaillees par etape</h2>
      <div class="table-container">
        <table>
          <thead>
            <tr><th>Etape</th><th>Moyenne</th><th>Mediane</th><th>P25</th><th>P75</th><th>Min</th><th>Max</th><th>Echantillon</th><th>~Mois</th></tr>
          </thead>
          <tbody id="duration-tbody"></tbody>
        </table>
      </div>
    </div>

  </div>

  <!-- Footer -->
  <footer class="text-center py-6 md:py-8 text-text-dim text-sm pb-20 md:pb-8">
    <p><a href="https://github.com/Letranger-dev/anef-extension" class="text-primary-light hover:underline">ANEF Status Tracker</a> &mdash; Extension Chrome</p>
  </footer>

  <script src="shared/constants.js"></script>
  <script src="shared/utils.js"></script>
  <script src="shared/stats-math.js"></script>
  <script src="config.local.js" onerror="/* not in local dev */"></script>
  <script src="shared/data.js"></script>
  <script src="shared/charts.js"></script>
  <script src="shared/filters.js"></script>
  <script src="shared/searchable-select.js"></script>
  <script src="shared/nav.js"></script>
  <script src="pages/delais.js"></script>
</body>
</html>
