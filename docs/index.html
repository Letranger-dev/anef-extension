<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="icon" type="image/svg+xml" href="favicon.svg">
  <link rel="icon" type="image/png" sizes="32x32" href="favicon-32.png">
  <title>ANEF Stats — Accueil</title>
  <meta name="description" content="Statistiques anonymes sur les délais de naturalisation française - données communautaires ANEF">
  <link rel="stylesheet" href="shared/common.css">
  <script src="https://cdn.tailwindcss.com"></script>
  <script>
    tailwind.config = {
      theme: {
        extend: {
          colors: {
            bg: '#0f172a',
            'bg-card': '#1e293b',
            'bg-hover': '#334155',
            border: '#334155',
            'text-main': '#e2e8f0',
            'text-muted': '#94a3b8',
            'text-dim': '#64748b',
            primary: '#3b82f6',
            'primary-light': '#60a5fa',
            success: '#10b981',
            warning: '#f59e0b',
            violet: '#8b5cf6',
            danger: '#ef4444',
          },
          maxWidth: { container: '1200px' },
          borderRadius: { card: '12px' },
        }
      }
    }
  </script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4/dist/chart.umd.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-datalabels@2/dist/chartjs-plugin-datalabels.min.js"></script>
</head>
<body class="bg-bg font-sans text-text-main leading-relaxed min-h-screen">

  <!-- Header -->
  <header class="bg-bg-card border-b-[3px]" style="border-image:linear-gradient(to right,#002395,#fff,#ED2939) 1">
    <div class="max-w-container mx-auto px-4 py-5 md:py-8 text-center">
      <h1 class="text-xl md:text-2xl font-bold mb-1">ANEF Status Tracker</h1>
      <p class="text-text-muted text-base">Statistiques communautaires sur les délais de naturalisation</p>
      <span class="inline-block bg-primary text-white text-xs px-3 py-1 rounded-full mt-2">Données anonymes</span>
    </div>
  </header>

  <!-- Desktop Nav -->
  <nav class="hidden md:block sticky top-0 z-50 bg-bg-card/95 backdrop-blur-md border-b border-border">
    <div class="max-w-container mx-auto px-6 flex overflow-x-auto">
      <a href="index.html" class="nav-link py-3 px-5 text-[0.9rem] font-semibold text-text-dim whitespace-nowrap border-b-2 border-transparent hover:text-text-muted transition-colors">Accueil</a>
      <a href="dossiers.html" class="nav-link py-3 px-5 text-[0.9rem] font-semibold text-text-dim whitespace-nowrap border-b-2 border-transparent hover:text-text-muted transition-colors">Dossiers</a>
      <a href="prefectures.html" class="nav-link py-3 px-5 text-[0.9rem] font-semibold text-text-dim whitespace-nowrap border-b-2 border-transparent hover:text-text-muted transition-colors">Préfectures</a>
      <a href="delais.html" class="nav-link py-3 px-5 text-[0.9rem] font-semibold text-text-dim whitespace-nowrap border-b-2 border-transparent hover:text-text-muted transition-colors">Délais</a>
      <a href="guide.html" class="nav-link py-3 px-5 text-[0.9rem] font-semibold text-text-dim whitespace-nowrap border-b-2 border-transparent hover:text-text-muted transition-colors">Guide</a>
      <a href="feedback.html" class="nav-link py-3 px-5 text-[0.9rem] font-semibold text-text-dim whitespace-nowrap border-b-2 border-transparent hover:text-text-muted transition-colors">Contact</a>
    </div>
  </nav>

  <!-- Mobile Nav -->
  <nav class="md:hidden fixed bottom-0 inset-x-0 z-[999] bg-bg-card border-t border-border" style="padding-bottom:env(safe-area-inset-bottom,0)">
    <div class="flex justify-around items-stretch h-12">
      <a href="index.html" class="nav-link flex flex-col items-center justify-center flex-1 text-text-dim text-[0.55rem] font-medium">
        <span class="text-base leading-none mb-0.5">&#x1F3E0;</span>Accueil
      </a>
      <a href="dossiers.html" class="nav-link flex flex-col items-center justify-center flex-1 text-text-dim text-[0.55rem] font-medium">
        <span class="text-base leading-none mb-0.5">&#x1F4C1;</span>Dossiers
      </a>
      <a href="prefectures.html" class="nav-link flex flex-col items-center justify-center flex-1 text-text-dim text-[0.55rem] font-medium">
        <span class="text-base leading-none mb-0.5">&#x1F4CD;</span>Préf.
      </a>
      <a href="delais.html" class="nav-link flex flex-col items-center justify-center flex-1 text-text-dim text-[0.55rem] font-medium">
        <span class="text-base leading-none mb-0.5">&#x23F1;</span>Délais
      </a>
      <a href="guide.html" class="nav-link flex flex-col items-center justify-center flex-1 text-text-dim text-[0.55rem] font-medium">
        <span class="text-base leading-none mb-0.5">&#x1F4D6;</span>Guide
      </a>
      <a href="feedback.html" class="nav-link flex flex-col items-center justify-center flex-1 text-text-dim text-[0.55rem] font-medium">
        <span class="text-base leading-none mb-0.5">&#x1F4AC;</span>Contact
      </a>
    </div>
  </nav>

  <!-- Evolution banner -->
  <div class="max-w-container mx-auto px-4 md:px-6 mt-4">
    <div class="bg-primary/10 border border-primary/30 rounded-card px-4 py-3 text-center text-sm text-text-muted">
      Ce site est en constante évolution et s'améliore chaque jour. N'hésitez pas à revenir régulièrement pour découvrir les nouveautés !
    </div>
  </div>

  <!-- Loading -->
  <div id="loading" class="text-center py-12 text-text-muted">
    <div class="inline-block w-9 h-9 border-[3px] border-border border-t-primary rounded-full animate-spin mb-4"></div>
    <p class="text-base">Chargement des statistiques...</p>
  </div>

  <!-- Main Content -->
  <div id="main-content" class="max-w-container mx-auto px-4 md:px-6 py-4 md:py-6 pb-20 md:pb-6" style="display:none">

    <!-- KPIs -->
    <div class="section" id="kpi-section">
      <div class="kpi-grid">
        <div class="kpi-card">
          <div class="kpi-label">Dossiers suivis</div>
          <div class="kpi-value" id="kpi-dossiers">&mdash;</div>
          <div class="kpi-sub" id="kpi-dossiers-sub">dans la communauté</div>
        </div>
        <div class="kpi-card">
          <div class="kpi-label">Durée moyenne</div>
          <div class="kpi-value orange" id="kpi-avg-days">&mdash;</div>
          <div class="kpi-sub" id="kpi-avg-sub">depuis le dépôt</div>
        </div>
        <div class="kpi-card">
          <div class="kpi-label">Dernière mise à jour</div>
          <div class="kpi-value green" id="kpi-updated" style="font-size:1.1rem">&mdash;</div>
          <div class="kpi-sub">de la base de données</div>
        </div>
      </div>
    </div>

    <!-- Metro Timeline -->
    <div class="section" id="timeline-section">
      <h2>Timeline globale</h2>
      <p class="section-subtitle">Vue métro : chaque dossier est positionné à son étape actuelle</p>
      <div class="timeline-wrapper" id="timeline-wrapper"></div>
    </div>

    <!-- Mouvements du jour -->
    <div class="section" id="mouvements-section">
      <h2>Mouvements du jour</h2>
      <p class="section-subtitle">Transitions observées dans le pipeline SDANF / SCEC</p>
      <div class="mouvements-period" id="mouvements-period"></div>
      <div class="mouvements-grid" id="mouvements-grid"></div>
    </div>

    <!-- Attente SDANF -->
    <div class="section" id="sdanf-wait-section">
      <h2>Contrôle SDANF & SCEC</h2>
      <p class="section-subtitle">Dossiers à l'étape 9 — contrôle ministériel et vérification d'état civil</p>
      <div class="dossier-toolbar" id="sdanf-toolbar" style="display:none">
        <span class="dossier-count" id="sdanf-count">&mdash;</span>
        <div class="toolbar-controls">
          <select id="sdanf-sort" class="page-size-select" title="Trier">
            <option value="days-desc">Attente &darr;</option>
            <option value="days-asc">Attente &uarr;</option>
            <option value="pref">Préfecture</option>
          </select>
          <select id="sdanf-statut-filter" class="page-size-select" title="Statut">
            <option value="">Statut : tous</option>
          </select>
          <div id="sdanf-pref-filter-container"></div>
          <label class="toggle-filter" id="sdanf-changed-label" title="Afficher uniquement les dossiers dont le statut a changé">
            <input type="checkbox" id="sdanf-changed-filter">
            <span class="toggle-filter-text">Modifiés</span>
          </label>
          <select id="sdanf-page-size" class="page-size-select" title="Par page">
            <option value="5" selected>5 / page</option>
            <option value="10">10 / page</option>
            <option value="20">20 / page</option>
          </select>
        </div>
        <div class="pagination">
          <button id="sdanf-btn-prev" class="btn-page" disabled>&larr;</button>
          <span id="sdanf-page-info" class="page-info">1/1</span>
          <button id="sdanf-btn-next" class="btn-page">&rarr;</button>
        </div>
      </div>
      <div id="sdanf-kpis" class="kpi-grid" style="margin-bottom:0.75rem"></div>
      <div class="dossier-list" id="sdanf-list"></div>
    </div>

    <!-- Entretien pipeline -->
    <div class="section" id="entretien-section">
      <h2>Phase entretien &amp; décision préfecture</h2>
      <p class="section-subtitle">Dossiers entre la convocation d'entretien et le passage en SDANF</p>
      <div class="dossier-toolbar" id="entretien-toolbar" style="display:none">
        <span class="dossier-count" id="entretien-count">&mdash;</span>
        <div class="toolbar-controls">
          <select id="entretien-sort" class="page-size-select" title="Trier">
            <option value="days-desc">Ancienneté &darr;</option>
            <option value="days-asc">Ancienneté &uarr;</option>
            <option value="step-desc">Étape &darr;</option>
            <option value="step-asc">Étape &uarr;</option>
          </select>
          <select id="entretien-filter" class="page-size-select" title="Entretien">
            <option value="">Entretien : tous</option>
            <option value="passed">Passé</option>
            <option value="pending">En attente</option>
          </select>
          <select id="entretien-statut-filter" class="page-size-select" title="Statut">
            <option value="">Statut : tous</option>
          </select>
          <div id="entretien-pref-filter-container"></div>
          <label class="toggle-filter" id="entretien-changed-label" title="Afficher uniquement les dossiers dont le statut a changé">
            <input type="checkbox" id="entretien-changed-filter">
            <span class="toggle-filter-text">Modifiés</span>
          </label>
          <select id="entretien-page-size" class="page-size-select" title="Par page">
            <option value="5" selected>5 / page</option>
            <option value="10">10 / page</option>
            <option value="20">20 / page</option>
          </select>
        </div>
        <div class="pagination">
          <button id="entretien-btn-prev" class="btn-page" disabled>&larr;</button>
          <span id="entretien-page-info" class="page-info">1/1</span>
          <button id="entretien-btn-next" class="btn-page">&rarr;</button>
        </div>
      </div>
      <div id="entretien-kpis" class="kpi-grid" style="margin-bottom:0.75rem"></div>
      <div class="dossier-list" id="entretien-list"></div>
    </div>

    <!-- Recent Activity -->
    <div class="section" id="activity-section">
      <h2>Activité récente</h2>
      <p class="section-subtitle">Historique des changements observés</p>
      <div class="dossier-toolbar" id="activity-toolbar" style="display:none">
        <span class="dossier-count" id="activity-count">&mdash;</span>
        <div class="toolbar-controls">
          <select id="activity-type-filter" class="page-size-select" title="Type">
            <option value="all" selected>Tous types</option>
            <option value="first_seen">Nouveaux</option>
            <option value="step_change">Étapes</option>
            <option value="status_change">Progressions</option>
          </select>
          <select id="activity-page-size" class="page-size-select" title="Par page">
            <option value="5" selected>5 par page</option>
            <option value="10">10 par page</option>
            <option value="20">20 par page</option>
            <option value="50">50 par page</option>
          </select>
        </div>
        <div class="pagination">
          <button id="activity-btn-prev" class="btn-page" disabled>&larr;</button>
          <span id="activity-page-info" class="page-info">1/1</span>
          <button id="activity-btn-next" class="btn-page">&rarr;</button>
        </div>
      </div>
      <ul class="activity-feed" id="activity-feed"></ul>
    </div>

    <!-- Privacy -->
    <div class="privacy">
      <h3>Confidentialité et anonymat</h3>
      <ul>
        <li>Le numéro de dossier est remplacé par un hash SHA-256 irréversible</li>
        <li>Les dates sont tronquées au jour (pas d'heure ni de minute)</li>
        <li>Aucune donnée personnelle n'est collectée (pas de nom, email, adresse)</li>
        <li>Le partage est activé par défaut et peut être désactivé dans les paramètres</li>
      </ul>
    </div>

  </div>

  <!-- Footer -->
  <footer class="text-center py-6 md:py-8 text-text-dim text-sm pb-20 md:pb-8">
    <p><a href="https://github.com/Letranger-dev/anef-extension" class="text-primary-light hover:underline">ANEF Status Tracker</a> &mdash; Extension Chrome pour suivre votre naturalisation</p>
    <p>Données collectées anonymement par les utilisateurs de l'extension</p>
  </footer>

  <script src="shared/constants.js"></script>
  <script src="shared/utils.js"></script>
  <script src="shared/stats-math.js"></script>
  <script src="config.local.js" onerror="/* not in local dev */"></script>
  <script src="shared/data.js"></script>
  <script src="shared/charts.js"></script>
  <script src="shared/filters.js"></script>
  <script src="shared/nav.js"></script>
  <script src="pages/accueil.js"></script>
</body>
</html>
